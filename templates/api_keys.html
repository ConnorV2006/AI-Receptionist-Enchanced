{% extends "base.html" %}
{% block title %}API Keys - {{ clinic.name }}{% endblock %}
{% block content %}
<h1>API Keys for {{ clinic.name }}</h1>
<p><a href="{{ url_for('clinic_dashboard', slug=clinic.slug) }}">Back to Clinic Dashboard</a></p>

<h2>Create New API Key</h2>
<form method="post">
    <label for="name">Key name/description:</label><br />
    <input type="text" id="name" name="name" /><br /><br />
    <button type="submit">Generate Key</button>
</form>

<h2>Existing Keys</h2>
{% if clinic.api_keys %}
<table>
    <tr><th>Name</th><th>Key</th><th>Active</th><th>Created</th><th>Actions</th></tr>
    {% for k in clinic.api_keys %}
        <tr>
            <td>{{ k.name }}</td>
            <td>{{ k.key }}</td>
            <td>{{ 'Yes' if k.is_active else 'No' }}</td>
            <td>{{ k.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
            <td>
                {% if k.is_active %}
                <form class="inline" method="post" action="{{ url_for('api_key_revoke', slug=clinic.slug, key_id=k.id) }}" onsubmit="return confirm('Revoke this API key?');">
                    <button type="submit">Revoke</button>
                </form>
                {% else %}
                    Revoked
                {% endif %}
            </td>
        </tr>
    {% endfor %}
</table>
{% else %}
    <p>No API keys generated yet.</p>
{% endif %}
{% endblock %}